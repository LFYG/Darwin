Build nmap 7.50 for IOS 6.1.3

Xcode: 5.0.2
IOS SDK: 6.1

CC=$(xcrun -f clang)
CXX=$(xcrun -f clang++)
IOSDEVROOT=$(xcrun --sdk iphoneos --show-sdk-platform-path)/Developer
IOSSDKROOT=$(xcrun --sdk iphoneos --show-sdk-path | sed s/7.0.sdk/6.1.sdk/g)
export DEVROOT=$IOSDEVROOT
export SDKROOT=$IOSSDKROOT
export CC=$(xcrun -f clang)
export LD=$DEVROOT/usr/bin/ld
export AR=$DEVROOT/usr/bin/ar
export AS=$DEVROOT/usr/bin/as
export NM=$DEVROOT/usr/bin/nm
export RANLIB=$DEVROOT/usr/bin/ranlib
export CFLAGS="-g -O2 -arch armv7 -isysroot $SDKROOT -miphoneos-version-min=6.1 -I$SDKROOT/usr/include/"
export LDFLAGS="-arch armv7 -L$SDKROOT/usr/lib/"
export CPPFLAGS=$CFLAGS
export CXXFLAGS=$CFLAGS

# xcode iOS sdk link
MACSDKROOT=$(xcrun --sdk macosx --show-sdk-path)
ln -s $MACSDKROOT/usr/include/net/if_arp.h $IOSSDKROOT/usr/include/net/if_arp.h
ln -s $MACSDKROOT/usr/include/net/bpf.h $IOSSDKROOT/usr/include/net/bpf.h
ln -s $MACSDKROOT/usr/include/netinet/ip_icmp.h $IOSSDKROOT/usr/include/netinet/ip_icmp.h
ln -s $MACSDKROOT/usr/include/i386 $IOSSDKROOT/usr/include/i386
ln -s $MACSDKROOT/usr/include/openssl $IOSSDKROOT/usr/include/openssl
ln -s $MACSDKROOT/usr/include/sys/_types $IOSSDKROOT/usr/include/sys/_types
ln -s $MACSDKROOT/usr/include/libkern/i386 $IOSSDKROOT/usr/include/libkern/i386
ln -s $MACSDKROOT/usr/include/mach/i386 $IOSSDKROOT/usr/include/mach/i386

cd nmap-7.50

# Patch:
# debian patch
# sed -e 's/-llua5.3/-llua5.3 -llua5.3-lpeg/g' configure.ac > configure.ac2
# mv configure.ac2 configure.ac

# iOS armv7 patch
sed -e 's/ppc64/armv7/g' configure > configure2
mv configure2 configure
chmod +x ./configure

sed -e 's/-arch x86_64 -arch i386/-arch armv7/g' libpcap/configure.in > libpcap/configure.in2
mv libpcap/configure.in2 libpcap/configure.in

sed -e 's/-arch x86_64 -arch i386/-arch armv7/g' libpcap/configure > libpcap/configure2
mv libpcap/configure2 libpcap/configure
chmod +x libpcap/configure

# configure
./configure --host=i386-apple-darwin --target=armv7-apple-darwin --build=armv7-apple-darwin --with-libdnet=included --with-libpcap=included --with-libpcre=included --with-liblua=included --with-pcap=bpf

make
mkdir pkg
make install DESTDIR=pkg
# install ncat certs
mkdir -p pkg/usr/local/share/ncat
cp ncat/certs/ca-bundle.crt pkg/usr/local/share/ncat/

# Make deb
cd pkg
rm usr/local/bin/uninstall_zenmap usr/local/bin/zenmap usr/local/bin/nmapfe usr/local/bin/xnmap usr/local/bin/uninstall_ndiff usr/local/bin/ndiff
rm -r usr/local/lib usr/local/share/applications usr/local/share/zenmap
mkdir DEBIAN

cat << EOF > DEBIAN/control
Package: nmap
Priority: standard
Section: Networking
Installed-Size: 25900
Maintainer: Jay Freeman (saurik) <saurik@saurik.com>
Architecture: iphoneos-arm
Version: 7.50-1
Pre-Depends: dpkg (>= 1.14.25-8)
Depends: libpcap, openssl, pcre
Description: analyze and scan remote network hosts
Name: Nmap
EOF

cd ..
dpkg-deb --build --uniform-compression -Zgzip pkg nmap_7.50-1_iphoneos-arm.deb
