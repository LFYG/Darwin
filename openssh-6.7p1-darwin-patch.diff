diff -uNr openssh-6.7p1.orig/sandbox-darwin.c openssh-6.7p1/sandbox-darwin.c
--- openssh-6.7p1.orig/sandbox-darwin.c	2014-01-17 13:47:04.000000000 +0800
+++ openssh-6.7p1/sandbox-darwin.c	2017-07-05 12:27:44.000000000 +0800
@@ -62,8 +62,16 @@
 	struct rlimit rl_zero;
 
 	debug3("%s: starting Darwin sandbox", __func__);
+#ifdef __APPLE_SANDBOX_NAMED_EXTERNAL__
+#ifndef SANDBOX_NAMED_EXTERNAL
+#define SANDBOX_NAMED_EXTERNAL (0x3)
+#endif
+	if (sandbox_init("@PREFIX@/share/openssh/org.openssh.sshd.sb",
+		SANDBOX_NAMED_EXTERNAL, &errmsg) == -1)
+#else
 	if (sandbox_init(kSBXProfilePureComputation, SANDBOX_NAMED,
 	    &errmsg) == -1)
+#endif
 		fatal("%s: sandbox_init: %s", __func__, errmsg);
 
 	/*
diff -uNr openssh-6.7p1.orig/sshd.c openssh-6.7p1/sshd.c
--- openssh-6.7p1.orig/sshd.c	2014-08-27 02:11:55.000000000 +0800
+++ openssh-6.7p1/sshd.c	2017-07-05 12:30:25.000000000 +0800
@@ -705,14 +705,20 @@
 
 		/* Arrange for logging to be sent to the monitor */
 		set_log_handler(mm_log_handler, pmonitor);
+#ifdef __APPLE_SANDBOX_NAMED_EXTERNAL__
+		/* We need to do this before we chroot() so we can read sshd.sb */
+		if (box != NULL)
+			ssh_sandbox_child(box);
+#endif
 
 		/* Demote the child */
 		if (getuid() == 0 || geteuid() == 0)
 			privsep_preauth_child();
 		setproctitle("%s", "[net]");
+#ifndef __APPLE_SANDBOX_NAMED_EXTERNAL__
 		if (box != NULL)
 			ssh_sandbox_child(box);
-
+#endif
 		return 0;
 	}
 }
